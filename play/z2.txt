%CODE
# for y in range(100, 200):
#   y = y + 1

# THREAD 1
STORE_NAME  y

# y = y + 1
LOAD_NAME   y
LOAD_CONST  1
BINARY_ADD
STORE_NAME  y
# now loop back

# THREAD 2
STORE_NAME  y

# y = y + 1
LOAD_NAME   y
LOAD_CONST  1
BINARY_ADD
STORE_NAME  y
# now loop back


%INSTRUCTIONS
GLOBAL RETURN_STACK_ROW 2
GLOBAL RETURN_STACK_COL 50
GLOBAL STACK_ROW 8
GLOBAL STACK_COL 50
GLOBAL MESSAGE_ROW 25
GLOBAL MESSAGE_COL 40
GLOBAL VALUE_COL 54
GLOBAL VARIABLE_COL 62
GLOBAL CODE_COL 5
PUSH_NEW y
PUSH_RETURN R1
PUSH_RETURN R2
VISIBLE R1
VISIBLE R2
VISIBLE y
LOAD CODE
LOAD RETURN_STACK 2
LOAD STACK 1

# thread 1
COLOR GREEN
VALUE R1 741905
VALUE R2 -3407
CODE 5
VALUE y 100
CODE 8
VALUE R1 y
CODE 9
VALUE R2 1
CODE 10
ADD R1 1
VALUE R1 R1
CODE 11
VALUE y R1
CODE 12
# loop jump back, repeats
LOOP 11 2
COLOR RED
MESSAGE Thread 1 gets suspended
CODE 14

# thread 2
CODE 15
MESSAGE Thread 2 now runs
VALUE y 100
CODE 18
VALUE R1 y
CODE 19
VALUE R2 1
CODE 20
ADD R1 1
VALUE R1 R1
CODE 21
VALUE y R1
MESSAGE jump back
CODE 22
# loop jump back, repeats
LOOP 1 1
MESSAGE Thread 2 gets suspended
WAIT
%END
